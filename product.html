<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details | WideFind</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-[#f8f9fa]">

    <header class="glass-header">
        <div class="container mx-auto px-4 h-20 flex items-center justify-between">
            <a href="index.html" class="logo-gold">WideFind</a>
            <a href="cart.html" class="relative group">
                <span class="text-2xl">ðŸ›’</span>
                <span id="cart-count" class="cart-badge">0</span>
            </a>
        </div>
    </header>

    <main class="container mx-auto px-4 py-10">
        <nav class="mb-8 text-sm text-gray-500">
            <a href="index.html" class="hover:text-orange-600">Home</a> / 
            <span id="breadcrumb-cat">Category</span> / 
            <span id="breadcrumb-name" class="text-gray-900 font-medium">Product</span>
        </nav>

        <div class="bg-white rounded-[32px] p-6 md:p-12 shadow-sm border border-gray-100">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                
                <div class="space-y-4">
                    <div class="main-img-container rounded-2xl overflow-hidden bg-gray-50 border border-gray-100 aspect-square">
                        <img id="main-img" src="" alt="Product Image" class="w-full h-full object-cover transition-transform duration-500 hover:scale-110">
                    </div>
                    <div id="thumb-grid" class="grid grid-cols-4 gap-4">
                        </div>
                </div>

                <div class="flex flex-col">
                    <span id="prod-category" class="text-orange-600 font-bold text-xs uppercase tracking-widest mb-2">Category</span>
                    <h1 id="prod-title" class="text-3xl md:text-4xl font-bold text-gray-900 mb-4 leading-tight">Loading Product...</h1>
                    
                    <div class="flex items-center gap-4 mb-8">
                        <span id="prod-price" class="text-3xl font-extrabold text-gray-900">à§³0</span>
                        <span id="prod-old-price" class="text-xl text-gray-400 line-through hidden">à§³0</span>
                        <span id="prod-discount" class="bg-red-100 text-red-600 px-3 py-1 rounded-full text-sm font-bold hidden">0% OFF</span>
                    </div>

                    <p id="prod-desc" class="text-gray-600 leading-relaxed mb-8 border-t border-gray-100 pt-8">
                        Please wait while we fetch the product details...
                    </p>

                    <div class="mt-auto space-y-6">
                        <div class="flex items-center gap-6">
                            <div class="flex items-center border border-gray-200 rounded-xl overflow-hidden bg-gray-50">
                                <button onclick="updateQty(-1)" class="px-5 py-3 hover:bg-gray-200 transition-colors font-bold text-xl">-</button>
                                <input type="number" id="qty-input" value="1" min="1" class="w-12 text-center bg-transparent font-bold outline-none" readonly>
                                <button onclick="updateQty(1)" class="px-5 py-3 hover:bg-gray-200 transition-colors font-bold text-xl">+</button>
                            </div>
                            <p class="text-sm text-gray-400 font-medium">In Stock & Ready to Ship</p>
                        </div>

                        <button onclick="addToCartDetailed()" class="w-full bg-black text-white py-5 rounded-2xl font-bold text-lg uppercase tracking-wide hover:bg-orange-600 transition-all shadow-xl shadow-black/10 active:scale-[0.98]">
                            Add to Shopping Bag
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <div id="custom-cart-alert" class="cart-alert">
        <span id="alert-msg"></span>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDFsnU6n1-ag1XB8QgJcj5rqjWHxaJ71v8",
            authDomain: "my-ecom-site-168ab.firebaseapp.com",
            projectId: "my-ecom-site-168ab",
            storageBucket: "my-ecom-site-168ab.appspot.com",
            messagingSenderId: "995581566071",
            appId: "1:995581566071:web:1640d0236302d369aefa72",
            measurementId: "G-NLHKNBHCFN"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get('id');
        let currentProduct = null;

        async function loadProduct() {
            if (!productId) { window.location.href = 'index.html'; return; }

            try {
                const docRef = doc(db, "artifacts", "WideFind", "public", "data", "products", productId);
                const snap = await getDoc(docRef);

                if (snap.exists()) {
                    currentProduct = { id: snap.id, ...snap.data() };
                    displayProduct(currentProduct);
                } else {
                    document.getElementById('prod-title').innerText = "Product Not Found";
                }
            } catch (err) { console.error(err); }
        }

        function displayProduct(p) {
            document.getElementById('prod-title').innerText = p.name;
            document.getElementById('breadcrumb-name').innerText = p.name;
            document.getElementById('prod-category').innerText = p.category || "General";
            document.getElementById('breadcrumb-cat').innerText = p.category || "General";
            document.getElementById('prod-desc').innerText = p.description || "No description available for this premium product.";
            document.getElementById('prod-price').innerText = `à§³${p.price}`;

            // Image Gallery Logic
            const images = Array.isArray(p.images) ? p.images : [p.images];
            const mainImg = document.getElementById('main-img');
            mainImg.src = images[0];

            const thumbGrid = document.getElementById('thumb-grid');
            images.forEach((img, idx) => {
                const thumb = document.createElement('div');
                thumb.className = `cursor-pointer rounded-lg overflow-hidden border-2 ${idx === 0 ? 'border-orange-500' : 'border-transparent'}`;
                thumb.innerHTML = `<img src="${img}" class="w-full h-20 object-cover">`;
                thumb.onclick = () => {
                    mainImg.src = img;
                    document.querySelectorAll('#thumb-grid div').forEach(d => d.classList.remove('border-orange-500'));
                    thumb.classList.add('border-orange-500');
                };
                thumbGrid.appendChild(thumb);
            });

            // Discount UI
            if (p.originalPrice && p.originalPrice > p.price) {
                const oldPriceEl = document.getElementById('prod-old-price');
                const discEl = document.getElementById('prod-discount');
                const percent = Math.round(((p.originalPrice - p.price) / p.originalPrice) * 100);
                
                oldPriceEl.innerText = `à§³${p.originalPrice}`;
                oldPriceEl.classList.remove('hidden');
                discEl.innerText = `${percent}% OFF`;
                discEl.classList.remove('hidden');
            }
        }

        window.updateQty = function(val) {
            const input = document.getElementById('qty-input');
            let newVal = parseInt(input.value) + val;
            if (newVal < 1) newVal = 1;
            input.value = newVal;
        };

        window.addToCartDetailed = function() {
            const qty = parseInt(document.getElementById('qty-input').value);
            let cart = JSON.parse(localStorage.getItem('widefindCart') || "[]");
            const img = Array.isArray(currentProduct.images) ? currentProduct.images[0] : currentProduct.images;
            
            const existing = cart.find(i => i.itemId === `${currentProduct.id}-std`);
            if (existing) {
                existing.qty += qty;
            } else {
                cart.push({
                    itemId: `${currentProduct.id}-std`,
                    sku: currentProduct.id,
                    name: currentProduct.name,
                    price: currentProduct.price,
                    image: img,
                    qty: qty,
                    size: "Standard"
                });
            }
            
            localStorage.setItem('widefindCart', JSON.stringify(cart));
            updateCartCount();
            showToast(`${currentProduct.name} added to cart!`);
        };

        function updateCartCount() {
            const cart = JSON.parse(localStorage.getItem('widefindCart') || "[]");
            document.getElementById('cart-count').innerText = cart.reduce((s, i) => s + i.qty, 0);
        }

        function showToast(m) {
            const t = document.getElementById('custom-cart-alert');
            t.innerText = m;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3000);
        }

        loadProduct();
        updateCartCount();
    </script>
</body>
</html>
