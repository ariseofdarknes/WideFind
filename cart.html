<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Shopping Cart</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        .qty-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
        }
        .qty-btn {
            width: 30px;
            height: 30px;
            border: 2px solid #ff6600;
            background: white;
            color: #ff6600;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .qty-btn:hover {
            background: #ff6600;
            color: white;
        }
        .qty-display {
            font-weight: 600;
            min-width: 30px;
            text-align: center;
        }
    </style>
</head>
<body>

    <header class="site-header">
        <div class="container" style="display: flex; justify-content: space-between; align-items: center;">
             <h1><a href="index.html" class="logo-gold">WideFind</a></h1>
            <a href="index.html" style="font-weight: 600; color: #555; text-decoration: none;">← Continue Shopping</a>
        </div>
    </header>

    <main class="container">
        <div class="cart-page-container">
            <h2>Your Shopping Cart (<span id="cart-item-count">0</span> Items)</h2>
            <div id="cart-items-list"></div>
            
            <div id="cart-empty-message" style="text-align: center; padding: 50px; color: #999; display: none;">
                Your cart is empty! <a href="index.html">Start shopping now.</a>
            </div>

            <div class="cart-actions">
                <div class="cart-total">
                    Subtotal: <span id="cart-subtotal">৳0</span>
                </div>
                <a href="checkout.html" id="proceed-to-checkout" class="btn-buy" style="width: 250px; margin: 0;">PROCEED TO CHECKOUT</a>
            </div>
        </div>
    </main>

<script>
const CART_STORAGE_KEY = 'widefindCart';

// Helper to handle image URLs
function getValidImageURL(url) {
    if (!url) return "https://placehold.co/120x120?text=No+Image";
    return url;
}

function getCart() {
    const cartString = localStorage.getItem(CART_STORAGE_KEY);
    return cartString ? JSON.parse(cartString) : [];
}

// Fixed Global Remove Function
window.removeItem = function(itemId) {
    let cart = getCart();
    cart = cart.filter(item => item.itemId === itemId);
    localStorage.setItem(CART_STORAGE_KEY, JSON.stringify(cart));
    renderCart();
};

// Fixed Global Quantity Function
window.updateQuantity = function(itemId, change) {
    let cart = getCart();
    const item = cart.find(i => i.itemId === itemId);
    if (item) {
        let newQty = (parseInt(item.qty) || 1) + change;
        if (newQty < 1) return; // Prevent 0 or negative
        item.qty = newQty;
        localStorage.setItem(CART_STORAGE_KEY, JSON.stringify(cart));
        renderCart();
    }
};

function renderCart() {
    const cart = getCart();
    const listContainer = document.getElementById('cart-items-list');
    const countDisplay = document.getElementById('cart-item-count');
    const subtotalDisplay = document.getElementById('cart-subtotal');
    const emptyMessage = document.getElementById('cart-empty-message');
    const actions = document.querySelector('.cart-actions');
    
    listContainer.innerHTML = '';
    
    if (cart.length === 0) {
        countDisplay.textContent = '0';
        subtotalDisplay.textContent = '৳0';
        emptyMessage.style.display = 'block';
        if (actions) actions.style.display = 'none';
        return;
    }

    emptyMessage.style.display = 'none';
    if (actions) actions.style.display = 'flex';

    let totalSubtotal = 0;
    let totalQty = 0;

    cart.forEach(item => {
        const cleanPrice = Number(String(item.price).replace(/[^0-9.-]+/g, "")) || 0;
        const itemQty = parseInt(item.qty) || 1;
        const itemSubtotal = cleanPrice * itemQty;
        totalSubtotal += itemSubtotal;
        totalQty += itemQty;

        const itemElement = document.createElement('div');
        itemElement.classList.add('cart-item');
        itemElement.innerHTML = `
            <img src="${getValidImageURL(item.image)}" alt="${item.name}">
            <div class="item-details">
                <h4>${item.name}</h4>
                <p>Unit Price: ৳${cleanPrice}</p>
                <div class="qty-controls">
                    <button class="qty-btn" onclick="updateQuantity('${item.itemId}', -1)">−</button>
                    <span class="qty-display">${itemQty}</span>
                    <button class="qty-btn" onclick="updateQuantity('${item.itemId}', 1)">+</button>
                </div>
            </div>
            <div class="item-price">৳${itemSubtotal}</div>
            <div class="item-remove">
                <button onclick="removeItem('${item.itemId}')">✕</button>
            </div>
        `;
        listContainer.appendChild(itemElement);
    });

    countDisplay.textContent = totalQty;
    subtotalDisplay.textContent = `৳${totalSubtotal}`;
}

document.addEventListener("DOMContentLoaded", renderCart);
</script>

</body>
</html>



